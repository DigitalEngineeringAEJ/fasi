<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="betriebsanweisung_protocol_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                           <h1 style="text-align:center;">
                                Betriebsanweisung
                            </h1>
                        <br></br>
                        <br></br>
                             <div class="col-12">
                                 <div class="col-9  pull-left">

                                    <strong>Datum: </strong>
                               <t t-if="o.mail_activity_id.schedule_date">
                                   <span t-field="o.mail_activity_id.schedule_date" t-options="{&quot;format&quot;: &quot;dd.MM.yyyy&quot;}"/>
                               </t>
                                <t t-else="">
                                    <span t-field="o.date" t-options="{&quot;format&quot;: &quot;dd.MM.yyyy&quot;}"/>
                               </t>
                                     <br></br>
                                      <strong>Verantwortlich: </strong>
                                       <span t-field="o.mail_activity_id.user_id.name"/>
                                      <br></br>
                                      <strong>Arbeitsplatz/Arbeitsmittel/Tätigkeit: </strong>
                                       <span t-field="o.equipment_id.name"/>
                                 </div>
                                 <div class="col-3 pull-right">
                                      <address t-field="o.customer_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                 </div>
                        </div>

                        <table style="font-size:16px" class="table table-bordered">
                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Anwendungsbereich</strong>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <strong t-field="o.equipment_id.category_id.name"/> : <span t-field="o.equipment_id.name"/>
                                    <br></br>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Gefahren für Mensch und Umwelt</strong>
                                </td>
                            </tr>
                              <t t-set="last_activity_gefahrenquelle" t-value="request.env['mail.activity'].search([('equipment_id', '=', o.equipment_id.id), ('activity_type_id', '=', %(mail_activity_data_calibration_ei)d)], order='id desc', limit=1)"/>
                            <t  t-if="last_activity_gefahrenquelle and last_activity_gefahrenquelle.gefaehrdunsfaktor_ids">
                                <t t-foreach="last_activity_gefahrenquelle.gefaehrdunsfaktor_ids" t-as="risk">
                                 <tr>

                                    <td>
                                        <span t-field="risk.gefahrenquellen_typ_id.name"/>
                                    </td>
                                     <td>
                                         <span t-esc="risk.gefaehrdungsf_name.gefaehrdungsf"/>
                                    </td
                                    ><td>
                                      <span t-field="risk.gefahrenquellen_typ_beschreibung"/>
                                    </td>
                                </tr>
                                </t>
                            </t>
                            <t t-else="">
                                <tr>
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </tr>
                            </t>
                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Schutzmaßnahmen und Verhaltensregeln</strong>
                                </td>
                            </tr>
                              <tr>
                                <td colspan="3" style="text-align:center;">
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Verhalten bei Störungen / Verhalten bei Gefahrfall</strong>
                                </td>
                            </tr>
                              <tr>
                                <td colspan="3" style="text-align:center;">
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Verhalten bei Unfällen, Erste Hilfe</strong>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="3" style="text-align:center;">
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Instandhaltung, Reinigung, Entsorgung</strong>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="3" style="text-align:center;">
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="3" style="text-align:center;">
                                    <strong>Folgen der Nichtbeachtung</strong>
                                </td>
                            </tr>
                             <tr>
                                <td colspan="3" style="text-align:center;">
                                    <br></br>
                                    <br></br>
                                    <br></br>
                                </td>
                            </tr>
                        </table>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <record id="betriebsanweisung_protocol" model="ir.actions.report">
            <field name="name">Betriebsanweisung</field>
            <field name="model">equipment.protocol</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">wepelo_equipment.betriebsanweisung_protocol_template</field>
            <field name="report_file">wepelo_equipment.betriebsanweisung_protocol_template</field>
            <field name="print_report_name">(object._get_report_filename())</field>
            <field name="binding_model_id" ref="model_equipment_protocol"/>
            <field name="paperformat_id" ref="wepelo_equipment.paperformat_begehung"/>
            <field name="binding_type">report</field>
        </record>

</odoo>